# [리팩터링] 4. 테스트 구축하기

</br>

# 4.1 자가 테스트 코드의 가치

</br>

> 모든 테스트를 완전히 자동화하고 그 결과까지 스스로 검사하게 만들자
> </br>

- 생산성 증가
  - 디버깅 시간 감소
- 함수 몇 개만 작성해도 곧바로 테스트 추가
- 수동으로 하면 지겹지만 자동화하면 테스트 코드 작성하는 재미도 쏠쏠
- 테스트를 작성하기 가장 좋은 시점은 프로그래밍을 시작하기 전
  - TDD
- 리팩터링 전에 테스트 코드부터 작성
  </br>

# 4.3 첫 번째 테스트

</br>

- 모카 테스트 프레임워크
  - 테스트 코드를 블록 단위로 나눠서 각 블록에 테스트 스위트를 담는 구조
  - 테스트는 it 블록에 담김
  - fixture: 테스트에 필요한 데이터와 객체

</br>

> describe 블록과 it 블록에 부연 설명용 문자열을 넣을 수 있다.
> 실패한 테스트가 무엇인지 식별할 수 있을 정도로만 작성한다.

> 자주 테스트하라. 작성 중인 코드는 최소한 몇 분 간격으로 테스트하고, 적어도 하루에 한 번은 전체 테스트를 돌려보자.

</br>

- 실패한 테스트가 하나라도 있으면 리팩터링하면 안 됨

</br>

# 4.4 테스트 추가하기

</br>

- 테스트는 모든 메서드를 빠짐없이 하는 것이 아님
- 테스트는 위험 요인을 중심으로 작성해야 함!

> 완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행하는 게 낫다.

</br>

- 테스트 코드에서도 중복이 있으면 좋지 않음
  - 같은 픽스처 설정
- 픽스처를 바깥 범위로 끌어내는 방법 → 테스트 버그 유발할 가능성 있음
  - 테스트를 실행하는 순서에 따라 결과가 달라질 수 있음
  - `beforeEach` 구문 사용하면 각각의 테스트 바로 전에 실행됨
    - 코드를 읽는 이들도 블록 안의 모든 테스트가 똑같은 기준 데이터로부터 시작한다는 사실을 쉽게 알 수 있음
- 모든 테스트를 독립적으로 구성하라!

</br>

# 4.5 픽스처 수정하기

</br>

```jsx
it("change production", function () {
  asia.producers[0].production = 20;
  assert.equal(asia.shortfall, -6);
  assert.equal(asia.profit, 292);
});
```

</br>

1. `beforeEach` 블록에서 설정한 표준 픽스처를 취함
2. 테스트 수행
3. 이 픽스처가 일을 기대한 대로 처리했는지 검증
   </br>

- 해당 패턴
  - 설정 - 실행 - 검증
  - 조건 - 발생 - 결과
  - 준비 - 수행 - 단언
- 해체 (teardown) / 청소 (cleanup) 단계?
  - 픽스처를 제거하여 테스트들이 서로 영향을 주지 못하도록 막는 역할
  - 설정을 모두 `beforeEach` 에서 수행하면 프레임워크가 알아서 해체해줌
  - 생성하는 데 시간이 오래 걸려서 여러 테스트가 공유해야만 하는 픽스처(`beforeEach` 대신 바깥 범위에서 생성된 픽스처)가 있을 경우는 이 단계가 필요함
- 위의 테스트는 it 구문 하나에 두 가지 속성 검증 - 일반적으로 it 구문 하나 당 검증도 하나씩 - 위 경우는 하나로 묶어도 문제 없을 정도로 두 속성이 밀접하다고 판단
  </br>

# 4.6 경계 조건 검사하기

</br>

- 모든 일이 순조롭고 의도대로 사용되는 테스트 외에 문제가 생기는 경우도 테스트
- 예시
  - 컬랙션이 비어있는 경우
  - 숫자형이면 0, 음수
  - 의도하지 않은 데이터 형식 (숫자 → 문자형 일부러 집어넣기)
- 하나씩 해보면 사용자 관점에서 프로그램이 특이 상황을 어떻게 처리해야 할지 생각해볼 수 있음
  </br>

> 문제가 생길 가능성이 있는 경계 조건을 생각해보고 그 부분을 집중적으로 테스트하자

</br>

- 테스트를 너무 많이 작성하다 보면 오히려 의욕이 떨어져 하나도 작성하지 않게 될 수도…
  - 위험한 부분에 집중
- 테스트가 모든 버그를 걸러주지는 못해도 안심하고 리팩터링할 수 있는 보호막은 됨
  </br>

# 4.7 끝나지 않은 여정

</br>

- 이 장에서 한 테스트는 단위 테스트임 unit test
  - 코드의 작은 영역만을 대상으로 빠르게 실행
  - 자가 테스트 코드의 핵심
- 그 외에는 컴포넌트 사이의 상호작용, 다양한 계층 연동 검사, 성능 문제 테스트 등이 있음
- 단순히 테스트 커버리지 채우는 건 의미 없음
